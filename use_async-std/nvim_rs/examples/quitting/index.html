<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Quitting"><meta name="keywords" content="rust, rustlang, rust-lang, quitting"><title>nvim_rs::examples::quitting - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../../../normalize.css"><link rel="stylesheet" type="text/css" href="../../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../../../dark.css" disabled><link rel="stylesheet" type="text/css" href="../../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../../storage.js"></script><script src="../../../crates.js"></script><script defer src="../../../main.js"></script>
    <noscript><link rel="stylesheet" href="../../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../../favicon.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../../nvim_rs/index.html"><div class="logo-container"><img class="rust-logo" src="../../../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"></h2>
    </nav>
    <nav class="sidebar"><a class="sidebar-logo" href="../../../nvim_rs/index.html"><div class="logo-container"><img class="rust-logo" src="../../../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"><a href="#">Module quitting</a></h2><div class="sidebar-elems"><div id="sidebar-vars" data-name="quitting" data-ty="mod" data-relpath="./"></div><script defer src="./sidebar-items.js"></script></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../../../nvim_rs/index.html"><img class="rust-logo" src="../../../rust-logo.svg" alt="logo"></a><nav class="sub"><div class="theme-picker hidden"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="22" height="22" alt="Pick another theme!" src="../../../brush.svg"></button><div id="theme-choices" role="menu"></div></div><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../wheel.svg"></a></div></form></nav></div><section id="main-content" class="content"><div class="main-heading">
    <h1 class="fqn"><span class="in-band">Module <a href="../../index.html">nvim_rs</a>::<wbr><a href="../index.html">examples</a>::<wbr><a class="mod" href="#">quitting</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../../../src/nvim_rs/examples/quitting.rs.html#1-53">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="quitting"><a href="#quitting">Quitting</a></h2>
<p>A very small example showing how to handle quitting an application.</p>
<ul>
<li>Running as an rpc plugin, just have neovim close the channel corresponding
to our plugin</li>
<li>When embedding neovim, do the same via a command, as shown in this
example. Note that this final request <em>will</em> receive an error, since it will
not get an answer from neovim.</li>
</ul>
<p>Also note that all other pending requests will receive an EOF error as well.</p>
<h3 id="usage"><a href="#usage">Usage</a></h3>
<p>First, build the neovim included as a submodule:</p>
<div class="example-wrap"><pre class="language-sh"><code>cd neovim
make</code></pre></div>
<p>See <a href="https://github.com/neovim/neovim/wiki/Building-Neovim">https://github.com/neovim/neovim/wiki/Building-Neovim</a> for build options.
Nothing is really needed to run the example.</p>
<p>After that, run the example via</p>
<div class="example-wrap"><pre class="language-sh"><code>cargo run --example quitting</code></pre></div><h3 id="description"><a href="#description">Description</a></h3>
<p>Some overview over the code:</p>
<ul>
<li>
<p>Since we’re not interested in handling anything, our <code>NeovimHandler</code> is a
<a href="../../rpc/handler/struct.Dummy.html"><code>Dummy</code></a> that does nothing on requests and
notifications. We need to pass something that implements
<a href="futures::task::Spawn"><code>Spawn</code></a>, which is represented by the <code>Spawner</code>. It
doesn’t carry any data here. We implement <code>Spawn</code> in the most trivial way
possible, by calling <a href="tokio::spawn"><code>tokio::spawn</code></a> that in turn calls out
to the surrounding runtime.</p>
</li>
<li>
<p>Any shutdown logic should be handled after the channel was closed. We
don’t actually need to inspect the error, since the application will shut
down no matter what. If we need access to our handler for that, we should
implement <a href="https://doc.rust-lang.org/nightly/core/ops/drop/trait.Drop.html"><code>Drop</code></a> for it, see
<a href="../handler_drop/index.html"><code>handler_drop</code></a>.</p>
</li>
<li>
<p>The last command (the one that instructs neovim to close the channel) will
not receive an answer anymore, but an error. We just show the error and its
source for demonstation purposes. We use the
<a href="../../error/enum.CallError.html#method.is_channel_closed"><code>is_channel_closed</code></a> method
to verify that the error originates from this.</p>
</li>
</ul>
</div></details></section><section id="search" class="content hidden"></section></div></main><div id="rustdoc-vars" data-root-path="../../../" data-current-crate="nvim_rs" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.61.0-nightly (0677edc86 2022-03-31)" ></div>
</body></html>